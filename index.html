<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üé∞ H√¥m Nay ƒÇn G√¨?</title>
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Quicksand', sans-serif; min-height: 100vh; overflow-x: hidden; background: #0f0c29; }
        .bg-animation { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(-45deg, #0f0c29, #302b63, #24243e, #0f0c29); background-size: 400% 400%; animation: gradientBG 15s ease infinite; z-index: -2; }
        .floating-foods { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; overflow: hidden; }
        .floating-food { position: absolute; font-size: 2rem; opacity: 0.3; animation: float 20s infinite linear; }
        @keyframes gradientBG { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
        @keyframes float { 0% { transform: translateY(100vh) rotate(0deg); opacity: 0; } 10% { opacity: 0.3; } 90% { opacity: 0.3; } 100% { transform: translateY(-100vh) rotate(720deg); opacity: 0; } }
        .container { min-height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 20px; }
        .main-card { background: rgba(255,255,255,0.1); backdrop-filter: blur(20px); border-radius: 30px; padding: 40px 35px; max-width: 650px; width: 100%; border: 1px solid rgba(255,255,255,0.2); box-shadow: 0 25px 50px rgba(0,0,0,0.5); }
        .title { text-align: center; margin-bottom: 30px; }
        .title h1 { font-size: 2.2rem; color: white; text-shadow: 0 0 30px rgba(255,255,255,0.5); margin-bottom: 8px; }
        .title p { color: rgba(255,255,255,0.7); font-size: 1rem; }
        .section-label { color: rgba(255,255,255,0.6); font-size: 0.85rem; margin-bottom: 10px; text-align: center; text-transform: uppercase; letter-spacing: 1px; }
        .profile-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-bottom: 20px; }
        .profile-btn { padding: 12px 8px; border: 2px solid rgba(255,255,255,0.2); background: rgba(255,255,255,0.05); color: white; border-radius: 15px; cursor: pointer; font-family: inherit; font-size: 0.85rem; font-weight: 600; transition: all 0.3s ease; display: flex; flex-direction: column; align-items: center; gap: 5px; }
        .profile-btn .emoji { font-size: 1.5rem; }
        .profile-btn:hover { border-color: var(--accent-color, #e94560); background: rgba(233,69,96,0.2); transform: translateY(-2px); }
        .profile-btn.active { background: var(--accent-gradient, linear-gradient(135deg, #e94560, #ff6b6b)); border-color: transparent; box-shadow: 0 5px 20px rgba(233,69,96,0.4); }
        .category-tabs { display: flex; gap: 8px; margin-bottom: 20px; justify-content: center; flex-wrap: wrap; }
        .tab { padding: 10px 20px; border: 2px solid rgba(255,255,255,0.3); background: transparent; color: white; border-radius: 50px; cursor: pointer; font-family: inherit; font-size: 0.9rem; font-weight: 600; transition: all 0.3s ease; }
        .tab:hover { border-color: var(--accent-color, #e94560); background: rgba(233,69,96,0.2); }
        .tab.active { background: var(--accent-gradient, linear-gradient(135deg, #e94560, #ff6b6b)); border-color: transparent; box-shadow: 0 5px 20px rgba(233,69,96,0.4); }
        .slot-machine { background: linear-gradient(145deg, #1a1a2e, #16213e); border-radius: 20px; padding: 25px; margin-bottom: 25px; border: 3px solid var(--accent-color, #e94560); box-shadow: 0 0 30px var(--glow-color, rgba(233,69,96,0.3)), inset 0 0 30px rgba(0,0,0,0.5); position: relative; }
        .slot-display { display: flex; justify-content: center; gap: 10px; margin-bottom: 15px; }
        .slot-window { width: 70px; height: 90px; background: #0f0f23; border-radius: 10px; overflow: hidden; border: 2px solid #ffd700; box-shadow: inset 0 0 20px rgba(0,0,0,0.8); }
        .slot-reel { display: flex; flex-direction: column; align-items: center; }
        .slot-item { width: 70px; height: 90px; display: flex; align-items: center; justify-content: center; font-size: 2.5rem; }
        .result-display { text-align: center; min-height: 100px; display: flex; flex-direction: column; justify-content: center; }
        .food-name { font-size: 1.6rem; color: #ffd700; font-weight: 700; text-shadow: 0 0 20px rgba(255,215,0,0.5); margin-bottom: 8px; opacity: 0; transform: scale(0.5); transition: all 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55); }
        .food-name.show { opacity: 1; transform: scale(1); }
        .food-desc { color: rgba(255,255,255,0.8); font-size: 0.95rem; opacity: 0; transition: opacity 0.5s ease 0.3s; }
        .food-desc.show { opacity: 1; }
        .food-tags { display: flex; justify-content: center; gap: 8px; margin-top: 10px; flex-wrap: wrap; opacity: 0; transition: opacity 0.5s ease 0.4s; }
        .food-tags.show { opacity: 1; }
        .food-tag { background: rgba(255,255,255,0.15); padding: 4px 12px; border-radius: 20px; font-size: 0.75rem; color: rgba(255,255,255,0.9); }
        .food-tag.price { background: rgba(76, 175, 80, 0.3); }
        .food-tag.healthy { background: rgba(33, 150, 243, 0.3); }
        .food-tag.quick { background: rgba(255, 152, 0, 0.3); }
        .spin-btn { width: 100%; padding: 18px; font-size: 1.3rem; font-weight: 700; font-family: inherit; border: none; border-radius: 15px; cursor: pointer; background: linear-gradient(135deg, #ffd700, #ffaa00); color: #1a1a2e; box-shadow: 0 10px 30px rgba(255,215,0,0.4); transition: all 0.3s ease; position: relative; overflow: hidden; }
        .spin-btn::before { content: ''; position: absolute; top: 0; left: -100%; width: 100%; height: 100%; background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent); transition: left 0.5s ease; }
        .spin-btn:hover::before { left: 100%; }
        .spin-btn:hover { transform: translateY(-3px); box-shadow: 0 15px 40px rgba(255,215,0,0.6); }
        .spin-btn:disabled { opacity: 0.7; cursor: not-allowed; transform: none; }
        .budget-section { display: flex; align-items: center; justify-content: center; gap: 15px; margin-bottom: 20px; flex-wrap: wrap; }
        .budget-label { color: rgba(255,255,255,0.7); font-size: 0.9rem; }
        .budget-slider { width: 150px; -webkit-appearance: none; height: 8px; border-radius: 5px; background: rgba(255,255,255,0.2); outline: none; }
        .budget-slider::-webkit-slider-thumb { -webkit-appearance: none; width: 20px; height: 20px; border-radius: 50%; background: #ffd700; cursor: pointer; box-shadow: 0 0 10px rgba(255,215,0,0.5); }
        .budget-value { color: #ffd700; font-weight: 700; min-width: 80px; }

        /* Maps Section */
        .maps-section { margin-top: 20px; display: none; animation: slideUp 0.5s ease; }
        .maps-section.show { display: block; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .maps-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 15px; flex-wrap: wrap; gap: 10px; }
        .maps-title { color: white; font-size: 1rem; display: flex; align-items: center; gap: 8px; }
        .location-status { font-size: 0.8rem; padding: 5px 12px; border-radius: 20px; background: rgba(255,255,255,0.1); color: rgba(255,255,255,0.7); }
        .location-status.active { background: rgba(76, 175, 80, 0.3); color: #81c784; }
        .location-status.error { background: rgba(244, 67, 54, 0.3); color: #e57373; }
        .nearby-places { display: flex; flex-direction: column; gap: 10px; max-height: 300px; overflow-y: auto; padding-right: 5px; }
        .nearby-places::-webkit-scrollbar { width: 5px; }
        .nearby-places::-webkit-scrollbar-track { background: rgba(255,255,255,0.1); border-radius: 5px; }
        .nearby-places::-webkit-scrollbar-thumb { background: var(--accent-color, #e94560); border-radius: 5px; }
        .place-card { background: rgba(255,255,255,0.08); border-radius: 15px; padding: 15px; display: flex; gap: 15px; align-items: center; transition: all 0.3s ease; cursor: pointer; border: 1px solid transparent; }
        .place-card:hover { background: rgba(255,255,255,0.12); border-color: var(--accent-color, #e94560); transform: translateX(5px); }
        .place-icon { font-size: 2rem; min-width: 50px; height: 50px; display: flex; align-items: center; justify-content: center; background: rgba(255,255,255,0.1); border-radius: 12px; }
        .place-info { flex: 1; }
        .place-name { color: white; font-weight: 600; font-size: 0.95rem; margin-bottom: 4px; }
        .place-address { color: rgba(255,255,255,0.6); font-size: 0.8rem; margin-bottom: 6px; }
        .place-meta { display: flex; gap: 10px; flex-wrap: wrap; }
        .place-rating { color: #ffd700; font-size: 0.8rem; display: flex; align-items: center; gap: 3px; }
        .place-distance { color: rgba(255,255,255,0.5); font-size: 0.8rem; }
        .place-status { font-size: 0.75rem; padding: 2px 8px; border-radius: 10px; }
        .place-status.open { background: rgba(76, 175, 80, 0.3); color: #81c784; }
        .place-status.closed { background: rgba(244, 67, 54, 0.3); color: #e57373; }
        .maps-actions { display: flex; gap: 10px; margin-top: 15px; }
        .map-btn { flex: 1; padding: 12px; border: none; border-radius: 12px; cursor: pointer; font-family: inherit; font-size: 0.9rem; font-weight: 600; transition: all 0.3s ease; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .map-btn.primary { background: linear-gradient(135deg, #4285f4, #34a853); color: white; }
        .map-btn.secondary { background: rgba(255,255,255,0.1); color: white; border: 1px solid rgba(255,255,255,0.2); }
        .map-btn:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0,0,0,0.3); }
        .loading-spinner { display: inline-block; width: 20px; height: 20px; border: 2px solid rgba(255,255,255,0.3); border-top-color: white; border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .no-results { text-align: center; padding: 30px; color: rgba(255,255,255,0.5); }
        .no-results .emoji { font-size: 3rem; margin-bottom: 10px; }
        /* History */
        .history { margin-top: 25px; padding-top: 20px; border-top: 1px solid rgba(255,255,255,0.1); }
        .history h3 { color: rgba(255,255,255,0.6); font-size: 0.85rem; margin-bottom: 12px; text-align: center; }
        .history-items { display: flex; gap: 8px; justify-content: center; flex-wrap: wrap; }
        .history-item { background: rgba(255,255,255,0.1); padding: 6px 12px; border-radius: 20px; color: white; font-size: 0.8rem; animation: popIn 0.3s ease; }
        @keyframes popIn { from { transform: scale(0); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        .confetti { position: fixed; width: 10px; height: 10px; top: -10px; z-index: 1000; animation: confettiFall 3s ease-out forwards; }
        @keyframes confettiFall { 0% { transform: translateY(0) rotate(0deg); opacity: 1; } 100% { transform: translateY(100vh) rotate(720deg); opacity: 0; } }
        .lucky-badge { position: absolute; top: -12px; right: -12px; background: linear-gradient(135deg, #ff6b6b, #e94560); color: white; padding: 6px 12px; border-radius: 20px; font-size: 0.75rem; font-weight: 700; animation: pulse 2s infinite; display: none; }
        .lucky-badge.show { display: block; }
        @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.1); } }
        .sound-toggle { position: fixed; top: 20px; right: 20px; background: rgba(255,255,255,0.1); border: none; width: 45px; height: 45px; border-radius: 50%; cursor: pointer; font-size: 1.3rem; backdrop-filter: blur(10px); transition: all 0.3s ease; }
        .sound-toggle:hover { background: rgba(255,255,255,0.2); transform: scale(1.1); }
        .theme-student { --accent-color: #4ecdc4; --accent-gradient: linear-gradient(135deg, #4ecdc4, #44a08d); --glow-color: rgba(78,205,196,0.3); }
        .theme-office { --accent-color: #667eea; --accent-gradient: linear-gradient(135deg, #667eea, #764ba2); --glow-color: rgba(102,126,234,0.3); }
        .theme-diet { --accent-color: #56ab2f; --accent-gradient: linear-gradient(135deg, #56ab2f, #a8e063); --glow-color: rgba(86,171,47,0.3); }
        .theme-family { --accent-color: #f093fb; --accent-gradient: linear-gradient(135deg, #f093fb, #f5576c); --glow-color: rgba(240,147,251,0.3); }
        .theme-gym { --accent-color: #ff6b6b; --accent-gradient: linear-gradient(135deg, #ff6b6b, #ee5a24); --glow-color: rgba(255,107,107,0.3); }
        .theme-kid { --accent-color: #ffd93d; --accent-gradient: linear-gradient(135deg, #ffd93d, #ff6b6b); --glow-color: rgba(255,217,61,0.3); }
        .theme-senior { --accent-color: #a29bfe; --accent-gradient: linear-gradient(135deg, #a29bfe, #6c5ce7); --glow-color: rgba(162,155,254,0.3); }
        .theme-couple { --accent-color: #fd79a8; --accent-gradient: linear-gradient(135deg, #fd79a8, #e84393); --glow-color: rgba(253,121,168,0.3); }
        @media (max-width: 500px) { .profile-grid { grid-template-columns: repeat(2, 1fr); } .main-card { padding: 25px 20px; } .title h1 { font-size: 1.8rem; } .maps-actions { flex-direction: column; } }
    </style>
</head>
<body>
    <div class="bg-animation"></div>
    <div class="floating-foods" id="floatingFoods"></div>
    <button class="sound-toggle" id="soundToggle" title="B·∫≠t/T·∫Øt √¢m thanh">üîä</button>
    <div class="container">
        <div class="main-card">
            <div class="title">
                <h1>üé∞ H√¥m Nay ƒÇn G√¨?</h1>
                <p>Ch·ªçn ƒë·ªëi t∆∞·ª£ng & quay s·ªë may m·∫Øn!</p>
            </div>
            <p class="section-label">üë§ B·∫°n l√† ai?</p>
            <div class="profile-grid">
                <button class="profile-btn active" data-profile="student" data-theme="theme-student"><span class="emoji">üéí</span><span>H·ªçc sinh</span></button>
                <button class="profile-btn" data-profile="office" data-theme="theme-office"><span class="emoji">üíº</span><span>VƒÉn ph√≤ng</span></button>
                <button class="profile-btn" data-profile="diet" data-theme="theme-diet"><span class="emoji">ü•ó</span><span>ƒÇn ki√™ng</span></button>
                <button class="profile-btn" data-profile="family" data-theme="theme-family"><span class="emoji">üë®‚Äçüë©‚Äçüëß</span><span>Gia ƒë√¨nh</span></button>
                <button class="profile-btn" data-profile="gym" data-theme="theme-gym"><span class="emoji">üí™</span><span>Gym</span></button>
                <button class="profile-btn" data-profile="kid" data-theme="theme-kid"><span class="emoji">üë∂</span><span>Tr·∫ª em</span></button>
                <button class="profile-btn" data-profile="senior" data-theme="theme-senior"><span class="emoji">üë¥</span><span>Ng∆∞·ªùi l·ªõn tu·ªïi</span></button>
                <button class="profile-btn" data-profile="couple" data-theme="theme-couple"><span class="emoji">üíë</span><span>C·∫∑p ƒë√¥i</span></button>
            </div>
            <div class="budget-section">
                <span class="budget-label">üí∞ Ng√¢n s√°ch:</span>
                <input type="range" class="budget-slider" id="budgetSlider" min="1" max="4" value="2">
                <span class="budget-value" id="budgetValue">V·ª´a ph·∫£i</span>
            </div>
            <div class="category-tabs">
                <button class="tab active" data-category="snack">üçø ƒÇn V·∫∑t</button>
                <button class="tab" data-category="dinner">üç≤ ƒÇn Chi·ªÅu</button>
                <button class="tab" data-category="all">üé≤ T·∫•t C·∫£</button>
            </div>
            <div class="slot-machine">
                <div class="lucky-badge" id="luckyBadge">üçÄ JACKPOT!</div>
                <div class="slot-display">
                    <div class="slot-window"><div class="slot-reel" id="reel1"></div></div>
                    <div class="slot-window"><div class="slot-reel" id="reel2"></div></div>
                    <div class="slot-window"><div class="slot-reel" id="reel3"></div></div>
                </div>
                <div class="result-display">
                    <div class="food-name" id="foodName">Ch·ªçn ƒë·ªëi t∆∞·ª£ng & b·∫•m QUAY!</div>
                    <div class="food-desc" id="foodDesc"></div>
                    <div class="food-tags" id="foodTags"></div>
                </div>
            </div>
            <button class="spin-btn" id="spinBtn">üé∞ QUAY NGAY!</button>

            <!-- Maps Section -->
            <div class="maps-section" id="mapsSection">
                <div class="maps-header">
                    <div class="maps-title">üìç Qu√°n g·∫ßn b·∫°n</div>
                    <div class="location-status" id="locationStatus">Ch∆∞a b·∫≠t v·ªã tr√≠</div>
                </div>
                <div class="nearby-places" id="nearbyPlaces">
                    <div class="no-results">
                        <div class="emoji">üìç</div>
                        <p>B·∫•m "T√¨m qu√°n g·∫ßn ƒë√¢y" ƒë·ªÉ xem g·ª£i √Ω</p>
                    </div>
                </div>
                <div class="maps-actions">
                    <button class="map-btn primary" id="findNearbyBtn">üìç T√¨m qu√°n g·∫ßn ƒë√¢y</button>
                    <button class="map-btn secondary" id="openMapsBtn">üó∫Ô∏è M·ªü Google Maps</button>
                </div>
            </div>
            <div class="history">
                <h3>üìú L·ªãch s·ª≠ g·ª£i √Ω</h3>
                <div class="history-items" id="historyItems"></div>
            </div>
        </div>
    </div>
<script>
const foods = {
    student: {
        snack: [
            { name: "B√°nh tr√°ng tr·ªôn", desc: "R·∫ª m√† ngon, ƒÉn ho√†i kh√¥ng ch√°n", emoji: "ü•ó", price: 1, tags: ["Gi√° r·∫ª", "Nhanh"], searchTerm: "b√°nh tr√°ng tr·ªôn" },
            { name: "Tr√† s·ªØa tr√¢n ch√¢u", desc: "H·ªçc b√†i m·ªát th√¨ u·ªëng cho t·ªânh", emoji: "üßã", price: 2, tags: ["Gi·∫£i kh√°t", "Ng·ªçt"], searchTerm: "tr√† s·ªØa" },
            { name: "B√°nh m√¨ que", desc: "Gi√≤n r·ª•m, ƒÉn v·ªôi gi·ªØa gi·ªù", emoji: "ü•ñ", price: 1, tags: ["Gi√° r·∫ª", "Nhanh"], searchTerm: "b√°nh m√¨" },
            { name: "Xo√†i l·∫Øc", desc: "Chua chua cay cay ƒë√£ mi·ªáng", emoji: "ü•≠", price: 1, tags: ["Gi√° r·∫ª", "Healthy"], searchTerm: "xo√†i l·∫Øc" },
            { name: "B√°nh tr√°ng n∆∞·ªõng", desc: "Pizza Vi·ªát Nam gi√° sinh vi√™n", emoji: "üçï", price: 1, tags: ["Gi√° r·∫ª", "No l√¢u"], searchTerm: "b√°nh tr√°ng n∆∞·ªõng" },
            { name: "Nem chua r√°n", desc: "Gi√≤n tan, ch·∫•m t∆∞∆°ng ·ªõt", emoji: "üç§", price: 1, tags: ["Gi√° r·∫ª", "Gi√≤n"], searchTerm: "nem chua r√°n" },
            { name: "Khoai t√¢y chi√™n", desc: "ƒÇn v·∫∑t kinh ƒëi·ªÉn", emoji: "üçü", price: 1, tags: ["Gi√° r·∫ª", "Gi√≤n"], searchTerm: "khoai t√¢y chi√™n" },
            { name: "B·∫Øp x√†o", desc: "Ng·ªçt b√πi th∆°m b∆°", emoji: "üåΩ", price: 1, tags: ["Gi√° r·∫ª", "Healthy"], searchTerm: "b·∫Øp x√†o" }
        ],
        dinner: [
            { name: "C∆°m b√¨nh d√¢n", desc: "No b·ª•ng, r·∫ª ti·ªÅn, ƒë·ªß ch·∫•t", emoji: "üçö", price: 1, tags: ["Gi√° r·∫ª", "No l√¢u"], searchTerm: "c∆°m b√¨nh d√¢n" },
            { name: "M√¨ t√¥m tr·ª©ng", desc: "M√≥n c·ª©u ƒë√≥i cu·ªëi th√°ng", emoji: "üçú", price: 1, tags: ["Si√™u r·∫ª", "Nhanh"], searchTerm: "qu√°n m√¨" },
            { name: "B√°nh m√¨ th·ªãt", desc: "ƒê·∫ßy ƒë·ªß nh√¢n, gi√° h·∫°t d·∫ª", emoji: "ü•™", price: 1, tags: ["Gi√° r·∫ª", "No l√¢u"], searchTerm: "b√°nh m√¨" },
            { name: "B√∫n b√≤", desc: "ƒê·∫≠m ƒë√†, ƒÉn l√† ghi·ªÅn", emoji: "üç≤", price: 2, tags: ["Ngon", "No l√¢u"], searchTerm: "b√∫n b√≤" },
            { name: "C∆°m g√† x·ªëi m·ª°", desc: "Gi√≤n r·ª•m, c∆°m th∆°m", emoji: "üçó", price: 2, tags: ["Ngon", "No l√¢u"], searchTerm: "c∆°m g√†" },
            { name: "Ph·ªü", desc: "M√≥n qu·ªëc d√¢n kh√¥ng bao gi·ªù ch√°n", emoji: "üçú", price: 2, tags: ["Ngon", "B·ªï d∆∞·ª°ng"], searchTerm: "ph·ªü" }
        ]
    },
    office: {
        snack: [
            { name: "C√† ph√™ s·ªØa ƒë√°", desc: "T·ªânh t√°o l√†m vi·ªác hi·ªáu qu·∫£", emoji: "‚òï", price: 2, tags: ["T·ªânh t√°o", "Nhanh"], searchTerm: "c√† ph√™" },
            { name: "Tr√† s·ªØa", desc: "Gi·∫£i stress gi·ªØa gi·ªù", emoji: "üßã", price: 2, tags: ["Th∆∞ gi√£n", "Ng·ªçt"], searchTerm: "tr√† s·ªØa" },
            { name: "B√°nh ng·ªçt", desc: "ƒÇn nh·∫π bu·ªïi chi·ªÅu", emoji: "üßÅ", price: 2, tags: ["Nh·∫π nh√†ng", "Ng·ªçt"], searchTerm: "ti·ªám b√°nh" },
            { name: "S·ªØa chua", desc: "Healthy, t·ªët cho ti√™u h√≥a", emoji: "ü•õ", price: 2, tags: ["Healthy", "Nh·∫π"], searchTerm: "s·ªØa chua" },
            { name: "Tr√°i c√¢y c·∫Øt", desc: "Vitamin t·ª± nhi√™n", emoji: "üçá", price: 2, tags: ["Healthy", "T∆∞∆°i"], searchTerm: "tr√°i c√¢y" },
            { name: "Sandwich", desc: "ƒÇn nhanh t·∫°i b√†n l√†m vi·ªác", emoji: "ü•™", price: 2, tags: ["Ti·ªán l·ª£i", "Nhanh"], searchTerm: "sandwich" }
        ],
        dinner: [
            { name: "C∆°m vƒÉn ph√≤ng", desc: "ƒê·∫∑t ship ti·ªán l·ª£i", emoji: "üç±", price: 2, tags: ["Ti·ªán l·ª£i", "ƒê·ªß ch·∫•t"], searchTerm: "c∆°m vƒÉn ph√≤ng" },
            { name: "Salad g√†", desc: "Nh·∫π nh√†ng, kh√¥ng bu·ªìn ng·ªß", emoji: "ü•ó", price: 3, tags: ["Healthy", "Nh·∫π"], searchTerm: "salad" },
            { name: "B√∫n ch·∫£", desc: "ƒê·ªïi v·ªã cu·ªëi tu·∫ßn", emoji: "ü•¢", price: 2, tags: ["Ngon", "Truy·ªÅn th·ªëng"], searchTerm: "b√∫n ch·∫£" },
            { name: "Ph·ªü", desc: "·∫§m b·ª•ng ng√†y m∆∞a", emoji: "üçú", price: 2, tags: ["Ngon", "·∫§m b·ª•ng"], searchTerm: "ph·ªü" },
            { name: "C∆°m t·∫•m", desc: "No l√¢u, l√†m vi·ªác hi·ªáu qu·∫£", emoji: "üçö", price: 2, tags: ["No l√¢u", "Ngon"], searchTerm: "c∆°m t·∫•m" },
            { name: "Sushi", desc: "Sang ch·∫£nh ch√∫t cu·ªëi tu·∫ßn", emoji: "üç£", price: 4, tags: ["Cao c·∫•p", "Healthy"], searchTerm: "sushi" }
        ]
    },
    diet: {
        snack: [
            { name: "S·ªØa chua Hy L·∫°p", desc: "√çt calo, gi√†u protein", emoji: "ü•õ", price: 2, tags: ["Low-cal", "Protein"], searchTerm: "s·ªØa chua" },
            { name: "Tr√°i c√¢y t∆∞∆°i", desc: "Vitamin t·ª± nhi√™n, √≠t ƒë∆∞·ªùng", emoji: "üçé", price: 2, tags: ["Healthy", "Vitamin"], searchTerm: "tr√°i c√¢y" },
            { name: "H·∫°t mix", desc: "Ch·∫•t b√©o t·ªët, no l√¢u", emoji: "ü•ú", price: 3, tags: ["Healthy", "Protein"], searchTerm: "h·∫°t dinh d∆∞·ª°ng" },
            { name: "Sinh t·ªë rau c·ªß", desc: "Detox, thanh l·ªçc c∆° th·ªÉ", emoji: "ü•§", price: 2, tags: ["Detox", "Vitamin"], searchTerm: "sinh t·ªë" },
            { name: "C√† r·ªët baby", desc: "ƒÇn v·∫∑t kh√¥ng lo tƒÉng c√¢n", emoji: "ü•ï", price: 1, tags: ["Low-cal", "Gi√≤n"], searchTerm: "rau c·ªß" },
            { name: "Tr√† xanh", desc: "ƒê·ªët m·ª°, tƒÉng trao ƒë·ªïi ch·∫•t", emoji: "üçµ", price: 1, tags: ["Detox", "0 cal"], searchTerm: "tr√†" }
        ],
        dinner: [
            { name: "Salad ·ª©c g√†", desc: "Protein cao, carb th·∫•p", emoji: "ü•ó", price: 3, tags: ["High protein", "Low carb"], searchTerm: "salad" },
            { name: "C√° h·∫•p rau c·ªß", desc: "Nh·∫π nh√†ng, ƒë·ªß ch·∫•t", emoji: "üêü", price: 3, tags: ["Healthy", "Omega-3"], searchTerm: "c√° h·∫•p" },
            { name: "S√∫p rau c·ªß", desc: "√çt calo, nhi·ªÅu ch·∫•t x∆°", emoji: "ü•£", price: 2, tags: ["Low-cal", "Ch·∫•t x∆°"], searchTerm: "s√∫p" },
            { name: "G·ªèi cu·ªën", desc: "T∆∞∆°i m√°t, √≠t d·∫ßu m·ª°", emoji: "üåØ", price: 2, tags: ["Fresh", "Low-cal"], searchTerm: "g·ªèi cu·ªën" },
            { name: "C∆°m g·∫°o l·ª©t", desc: "Carb ph·ª©c h·ª£p, no l√¢u", emoji: "üçö", price: 2, tags: ["Healthy", "Ch·∫•t x∆°"], searchTerm: "c∆°m g·∫°o l·ª©t" },
            { name: "Th·ªãt b√≤ √°p ch·∫£o", desc: "Protein ch·∫•t l∆∞·ª£ng cao", emoji: "ü•©", price: 4, tags: ["High protein", "Iron"], searchTerm: "b√≤ b√≠t t·∫øt" }
        ]
    },
    family: {
        snack: [
            { name: "Ch√® th√°i", desc: "C·∫£ nh√† c√πng th∆∞·ªüng th·ª©c", emoji: "üç®", price: 2, tags: ["Gia ƒë√¨nh", "M√°t l·∫°nh"], searchTerm: "ch√®" },
            { name: "B√°nh flan", desc: "Ai c≈©ng th√≠ch", emoji: "üçÆ", price: 2, tags: ["Ng·ªçt", "M·ªÅm m·ªãn"], searchTerm: "b√°nh flan" },
            { name: "Tr√°i c√¢y dƒ©a", desc: "Healthy cho c·∫£ nh√†", emoji: "üçá", price: 2, tags: ["Healthy", "T∆∞∆°i"], searchTerm: "tr√°i c√¢y" },
            { name: "Kem", desc: "Tr√°ng mi·ªáng ho√†n h·∫£o", emoji: "üç¶", price: 2, tags: ["Ng·ªçt", "M√°t"], searchTerm: "kem" },
            { name: "B√°nh b√¥ng lan", desc: "ƒÇn nh·∫π bu·ªïi chi·ªÅu", emoji: "üç∞", price: 2, tags: ["Nh·∫π nh√†ng", "Ng·ªçt"], searchTerm: "ti·ªám b√°nh" },
            { name: "S·ªØa ƒë·∫≠u n√†nh", desc: "B·ªï d∆∞·ª°ng cho m·ªçi l·ª©a tu·ªïi", emoji: "ü•õ", price: 1, tags: ["Healthy", "B·ªï d∆∞·ª°ng"], searchTerm: "s·ªØa ƒë·∫≠u n√†nh" }
        ],
        dinner: [
            { name: "L·∫©u", desc: "Qu√¢y qu·∫ßn b√™n nhau", emoji: "ü´ï", price: 4, tags: ["Gia ƒë√¨nh", "·∫§m c√∫ng"], searchTerm: "l·∫©u" },
            { name: "C∆°m nh√†", desc: "Kh√¥ng g√¨ b·∫±ng c∆°m m·∫π n·∫•u", emoji: "üçö", price: 2, tags: ["Gia ƒë√¨nh", "·∫§m c√∫ng"], searchTerm: "qu√°n c∆°m" },
            { name: "BBQ", desc: "N∆∞·ªõng vui v·∫ª cu·ªëi tu·∫ßn", emoji: "üçñ", price: 4, tags: ["Vui v·∫ª", "ƒêa d·∫°ng"], searchTerm: "n∆∞·ªõng BBQ" },
            { name: "Pizza", desc: "Ai c≈©ng th√≠ch, d·ªÖ chia", emoji: "üçï", price: 3, tags: ["Gia ƒë√¨nh", "ƒêa d·∫°ng"], searchTerm: "pizza" },
            { name: "G√† r√°n", desc: "Tr·∫ª con m√™ t√≠t", emoji: "üçó", price: 3, tags: ["Ngon", "Gi√≤n"], searchTerm: "g√† r√°n" },
            { name: "Ph·ªü", desc: "M√≥n Vi·ªát c·∫£ nh√† ƒë·ªÅu ∆∞a", emoji: "üçú", price: 2, tags: ["Truy·ªÅn th·ªëng", "Ngon"], searchTerm: "ph·ªü" }
        ]
    },

    gym: {
        snack: [
            { name: "Protein shake", desc: "Ph·ª•c h·ªìi c∆° sau t·∫≠p", emoji: "ü•§", price: 3, tags: ["Protein", "Recovery"], searchTerm: "protein" },
            { name: "Chu·ªëi", desc: "NƒÉng l∆∞·ª£ng nhanh, kali cao", emoji: "üçå", price: 1, tags: ["Energy", "Kali"], searchTerm: "tr√°i c√¢y" },
            { name: "Tr·ª©ng lu·ªôc", desc: "Protein s·∫°ch, ti·ªán l·ª£i", emoji: "ü•ö", price: 1, tags: ["Protein", "Clean"], searchTerm: "ƒë·ªì ƒÉn healthy" },
            { name: "Y·∫øn m·∫°ch", desc: "Carb ph·ª©c h·ª£p, no l√¢u", emoji: "ü•£", price: 2, tags: ["Carb", "Ch·∫•t x∆°"], searchTerm: "y·∫øn m·∫°ch" },
            { name: "H·∫°nh nh√¢n", desc: "Ch·∫•t b√©o t·ªët, protein", emoji: "ü•ú", price: 3, tags: ["Healthy fat", "Protein"], searchTerm: "h·∫°t dinh d∆∞·ª°ng" },
            { name: "Greek yogurt", desc: "Protein cao, √≠t ƒë∆∞·ªùng", emoji: "ü•õ", price: 2, tags: ["Protein", "Low sugar"], searchTerm: "s·ªØa chua" }
        ],
        dinner: [
            { name: "·ª®c g√† + khoai lang", desc: "Combo tƒÉng c∆° kinh ƒëi·ªÉn", emoji: "üçó", price: 3, tags: ["High protein", "Clean"], searchTerm: "·ª©c g√†" },
            { name: "C√° h·ªìi n∆∞·ªõng", desc: "Omega-3, protein ch·∫•t l∆∞·ª£ng", emoji: "üêü", price: 4, tags: ["Omega-3", "Protein"], searchTerm: "c√° h·ªìi" },
            { name: "B√≤ b√≠t t·∫øt", desc: "Protein + s·∫Øt cho gymer", emoji: "ü•©", price: 4, tags: ["Protein", "Iron"], searchTerm: "b√≤ b√≠t t·∫øt" },
            { name: "Salad protein", desc: "ƒê·ªß ch·∫•t, √≠t carb", emoji: "ü•ó", price: 3, tags: ["High protein", "Low carb"], searchTerm: "salad" },
            { name: "C∆°m g·∫°o l·ª©t g√†", desc: "Meal prep ho√†n h·∫£o", emoji: "üç±", price: 2, tags: ["Balanced", "Clean"], searchTerm: "c∆°m g·∫°o l·ª©t" },
            { name: "Tr·ª©ng chi√™n rau c·ªß", desc: "Nhanh g·ªçn, ƒë·ªß ch·∫•t", emoji: "üç≥", price: 2, tags: ["Protein", "Quick"], searchTerm: "qu√°n ƒÉn healthy" }
        ]
    },
    kid: {
        snack: [
            { name: "Kem ·ªëc qu·∫ø", desc: "Ph·∫ßn th∆∞·ªüng cho b√© ngoan", emoji: "üç¶", price: 2, tags: ["Ng·ªçt", "Y√™u th√≠ch"], searchTerm: "kem" },
            { name: "B√°nh quy", desc: "ƒÇn v·∫∑t an to√†n", emoji: "üç™", price: 1, tags: ["Ng·ªçt", "Gi√≤n"], searchTerm: "ti·ªám b√°nh" },
            { name: "S·ªØa t∆∞∆°i", desc: "Canxi cho b√© cao l·ªõn", emoji: "ü•õ", price: 1, tags: ["Canxi", "B·ªï d∆∞·ª°ng"], searchTerm: "s·ªØa" },
            { name: "Tr√°i c√¢y c·∫Øt", desc: "Vitamin t·ª± nhi√™n", emoji: "üçé", price: 2, tags: ["Vitamin", "Healthy"], searchTerm: "tr√°i c√¢y" },
            { name: "Pudding", desc: "M·ªÅm m·ªãn, b√© th√≠ch", emoji: "üçÆ", price: 2, tags: ["M·ªÅm", "Ng·ªçt"], searchTerm: "pudding" },
            { name: "Khoai t√¢y chi√™n", desc: "M√≥n b√© n√†o c≈©ng m√™", emoji: "üçü", price: 2, tags: ["Gi√≤n", "Y√™u th√≠ch"], searchTerm: "khoai t√¢y chi√™n" }
        ],
        dinner: [
            { name: "M√¨ √ù", desc: "S·ª£i m√¨ b√© d·ªÖ ƒÉn", emoji: "üçù", price: 2, tags: ["D·ªÖ ƒÉn", "Ngon"], searchTerm: "m√¨ √Ω" },
            { name: "C∆°m chi√™n tr·ª©ng", desc: "ƒê∆°n gi·∫£n, b√© th√≠ch", emoji: "üç≥", price: 2, tags: ["D·ªÖ ƒÉn", "Ngon"], searchTerm: "c∆°m chi√™n" },
            { name: "G√† vi√™n", desc: "H√¨nh d√°ng vui nh·ªôn", emoji: "üçó", price: 2, tags: ["Vui", "Protein"], searchTerm: "g√† r√°n" },
            { name: "S√∫p g√†", desc: "·∫§m b·ª•ng, d·ªÖ ti√™u", emoji: "ü•£", price: 2, tags: ["·∫§m", "B·ªï d∆∞·ª°ng"], searchTerm: "s√∫p" },
            { name: "Pizza mini", desc: "Size v·ª´a tay b√©", emoji: "üçï", price: 2, tags: ["Vui", "Y√™u th√≠ch"], searchTerm: "pizza" },
            { name: "Ch√°o th·ªãt b·∫±m", desc: "M·ªÅm, d·ªÖ nu·ªët", emoji: "ü•ò", price: 1, tags: ["M·ªÅm", "B·ªï d∆∞·ª°ng"], searchTerm: "ch√°o" }
        ]
    },
    senior: {
        snack: [
            { name: "Ch√® ƒë·∫≠u xanh", desc: "M√°t gan, thanh nhi·ªát", emoji: "üçµ", price: 1, tags: ["Thanh m√°t", "D·ªÖ ti√™u"], searchTerm: "ch√®" },
            { name: "Chu·ªëi ch√≠n", desc: "M·ªÅm, d·ªÖ ƒÉn, nhi·ªÅu kali", emoji: "üçå", price: 1, tags: ["M·ªÅm", "Kali"], searchTerm: "tr√°i c√¢y" },
            { name: "S·ªØa ƒë·∫≠u n√†nh", desc: "T·ªët cho x∆∞∆°ng kh·ªõp", emoji: "ü•õ", price: 1, tags: ["Canxi", "Protein"], searchTerm: "s·ªØa ƒë·∫≠u n√†nh" },
            { name: "B√°nh ƒë·∫≠u xanh", desc: "Truy·ªÅn th·ªëng, d·ªÖ ƒÉn", emoji: "üç°", price: 1, tags: ["M·ªÅm", "Truy·ªÅn th·ªëng"], searchTerm: "b√°nh ƒë·∫≠u xanh" },
            { name: "Tr√† th·∫£o m·ªôc", desc: "T·ªët cho s·ª©c kh·ªèe", emoji: "üçµ", price: 1, tags: ["Healthy", "Th∆∞ gi√£n"], searchTerm: "tr√†" },
            { name: "ƒêu ƒë·ªß ch√≠n", desc: "T·ªët cho ti√™u h√≥a", emoji: "üçà", price: 1, tags: ["M·ªÅm", "Ti√™u h√≥a"], searchTerm: "tr√°i c√¢y" }
        ],
        dinner: [
            { name: "Ch√°o", desc: "D·ªÖ ti√™u, ·∫•m b·ª•ng", emoji: "ü•£", price: 1, tags: ["M·ªÅm", "D·ªÖ ti√™u"], searchTerm: "ch√°o" },
            { name: "Canh rau c·ªß", desc: "Nhi·ªÅu vitamin, √≠t d·∫ßu m·ª°", emoji: "ü•ó", price: 1, tags: ["Healthy", "Nh·∫π"], searchTerm: "qu√°n chay" },
            { name: "C√° h·∫•p", desc: "M·ªÅm, nhi·ªÅu omega-3", emoji: "üêü", price: 2, tags: ["M·ªÅm", "Omega-3"], searchTerm: "c√° h·∫•p" },
            { name: "Ph·ªü", desc: "N∆∞·ªõc d√πng thanh, d·ªÖ ƒÉn", emoji: "üçú", price: 2, tags: ["Truy·ªÅn th·ªëng", "·∫§m"], searchTerm: "ph·ªü" },
            { name: "C∆°m m·ªÅm + canh", desc: "B·ªØa c∆°m ƒë∆°n gi·∫£n", emoji: "üçö", price: 1, tags: ["Truy·ªÅn th·ªëng", "Nh·∫π"], searchTerm: "qu√°n c∆°m" },
            { name: "S√∫p g√†", desc: "B·ªï d∆∞·ª°ng, d·ªÖ h·∫•p thu", emoji: "ü•ò", price: 2, tags: ["B·ªï d∆∞·ª°ng", "M·ªÅm"], searchTerm: "s√∫p" }
        ]
    },
    couple: {
        snack: [
            { name: "Tr√† s·ªØa ƒë√¥i", desc: "Ng·ªçt ng√†o nh∆∞ t√¨nh y√™u", emoji: "üßã", price: 2, tags: ["L√£ng m·∫°n", "Ng·ªçt"], searchTerm: "tr√† s·ªØa" },
            { name: "Kem 2 v·ªã", desc: "Chia s·∫ª v·ªã ng·ªçt", emoji: "üç¶", price: 2, tags: ["L√£ng m·∫°n", "Ng·ªçt"], searchTerm: "kem" },
            { name: "B√°nh crepe", desc: "Date cafe l√£ng m·∫°n", emoji: "ü•û", price: 3, tags: ["Sang", "L√£ng m·∫°n"], searchTerm: "crepe" },
            { name: "Tr√°i c√¢y dƒ©a", desc: "Healthy date", emoji: "üçì", price: 2, tags: ["Healthy", "Fresh"], searchTerm: "tr√°i c√¢y" },
            { name: "Chocolate", desc: "Ng·ªçt ng√†o b√™n nhau", emoji: "üç´", price: 2, tags: ["L√£ng m·∫°n", "Ng·ªçt"], searchTerm: "chocolate" },
            { name: "Waffle", desc: "ƒÇn v·∫∑t cu·ªëi tu·∫ßn", emoji: "üßá", price: 2, tags: ["Ng·ªçt", "Th∆∞ gi√£n"], searchTerm: "waffle" }
        ],
        dinner: [
            { name: "L·∫©u ƒë√¥i", desc: "·∫§m √°p b√™n nhau", emoji: "ü´ï", price: 3, tags: ["L√£ng m·∫°n", "·∫§m c√∫ng"], searchTerm: "l·∫©u" },
            { name: "Steak", desc: "Date night ho√†n h·∫£o", emoji: "ü•©", price: 4, tags: ["Sang tr·ªçng", "ƒê·∫∑c bi·ªát"], searchTerm: "steak" },
            { name: "Sushi", desc: "Tinh t·∫ø, l√£ng m·∫°n", emoji: "üç£", price: 4, tags: ["Sang", "Healthy"], searchTerm: "sushi" },
            { name: "Pizza", desc: "Chill t·∫°i nh√†", emoji: "üçï", price: 3, tags: ["Tho·∫£i m√°i", "Vui"], searchTerm: "pizza" },
            { name: "BBQ H√†n", desc: "N∆∞·ªõng vui v·∫ª", emoji: "ü•ì", price: 3, tags: ["Vui", "ƒêa d·∫°ng"], searchTerm: "n∆∞·ªõng h√†n qu·ªëc" },
            { name: "Pasta", desc: "L√£ng m·∫°n ki·ªÉu √ù", emoji: "üçù", price: 3, tags: ["L√£ng m·∫°n", "Ngon"], searchTerm: "pasta" }
        ]
    }
};

const budgetLabels = ['Si√™u r·∫ª', 'V·ª´a ph·∫£i', 'Tho·∫£i m√°i', 'Sang ch·∫£nh'];
let currentProfile = 'student';
let currentCategory = 'snack';
let currentBudget = 2;
let isSpinning = false;
let soundEnabled = true;
let history = [];
let userLocation = null;
let currentFood = null;
const allEmojis = ['üçú','üç≤','üçö','ü•™','üçù','ü•£','ü•ü','ü•ò','üåØ','üçó','üçü','üçï','üßã','üç¶','üç®','ü•ó','üç§','üåΩ','ü•≠','ü•ñ','üçÆ','üç¢','üêô','ü¶Ä','üêî','ü•û','ü´ò','ü´ï','‚òï','ü•õ','üçé','ü•ú','üçµ','ü•ï','üêü','ü•©','üçñ','üç£','ü•ö','üçå','ü•ì','üç´','üßá','üç™','üçà','üç°','üç≥','üßÅ','üçá','üç∞','üç±'];

const AudioContext = window.AudioContext || window.webkitAudioContext;
let audioCtx;

function playSound(type) {
    if (!soundEnabled) return;
    if (!audioCtx) audioCtx = new AudioContext();
    const oscillator = audioCtx.createOscillator();
    const gainNode = audioCtx.createGain();
    oscillator.connect(gainNode);
    gainNode.connect(audioCtx.destination);
    if (type === 'spin') {
        oscillator.frequency.value = 200 + Math.random() * 400;
        gainNode.gain.value = 0.1;
        oscillator.start();
        oscillator.stop(audioCtx.currentTime + 0.05);
    } else if (type === 'win') {
        oscillator.frequency.value = 523;
        gainNode.gain.value = 0.2;
        oscillator.start();
        setTimeout(() => oscillator.frequency.value = 659, 100);
        setTimeout(() => oscillator.frequency.value = 784, 200);
        oscillator.stop(audioCtx.currentTime + 0.4);
    } else if (type === 'jackpot') {
        [523, 659, 784, 1047].forEach((freq, i) => {
            setTimeout(() => {
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                osc.connect(gain);
                gain.connect(audioCtx.destination);
                osc.frequency.value = freq;
                gain.gain.value = 0.15;
                osc.start();
                osc.stop(audioCtx.currentTime + 0.15);
            }, i * 150);
        });
    }
}

function createFloatingFoods() {
    const container = document.getElementById('floatingFoods');
    for (let i = 0; i < 15; i++) {
        const food = document.createElement('div');
        food.className = 'floating-food';
        food.textContent = allEmojis[Math.floor(Math.random() * allEmojis.length)];
        food.style.left = Math.random() * 100 + '%';
        food.style.animationDelay = Math.random() * 20 + 's';
        food.style.animationDuration = (15 + Math.random() * 10) + 's';
        container.appendChild(food);
    }
}

function createConfetti() {
    const colors = ['#ffd700', '#e94560', '#ff6b6b', '#4ecdc4', '#45b7d1', '#96ceb4'];
    for (let i = 0; i < 50; i++) {
        setTimeout(() => {
            const confetti = document.createElement('div');
            confetti.className = 'confetti';
            confetti.style.left = Math.random() * 100 + '%';
            confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
            confetti.style.borderRadius = Math.random() > 0.5 ? '50%' : '0';
            confetti.style.width = (5 + Math.random() * 10) + 'px';
            confetti.style.height = confetti.style.width;
            document.body.appendChild(confetti);
            setTimeout(() => confetti.remove(), 3000);
        }, i * 30);
    }
}

function initReels() {
    [1, 2, 3].forEach(i => {
        const reel = document.getElementById('reel' + i);
        reel.innerHTML = '';
        const item = document.createElement('div');
        item.className = 'slot-item';
        item.textContent = allEmojis[Math.floor(Math.random() * allEmojis.length)];
        reel.appendChild(item);
    });
}

function updateTheme(theme) {
    document.body.className = theme;
}

// Location & Maps Functions
function getUserLocation() {
    return new Promise((resolve, reject) => {
        if (!navigator.geolocation) {
            reject(new Error('Tr√¨nh duy·ªát kh√¥ng h·ªó tr·ª£ ƒë·ªãnh v·ªã'));
            return;
        }
        navigator.geolocation.getCurrentPosition(
            position => {
                userLocation = {
                    lat: position.coords.latitude,
                    lng: position.coords.longitude
                };
                resolve(userLocation);
            },
            error => {
                reject(error);
            },
            { enableHighAccuracy: true, timeout: 10000 }
        );
    });
}

function updateLocationStatus(status, type = 'default') {
    const el = document.getElementById('locationStatus');
    el.textContent = status;
    el.className = 'location-status';
    if (type === 'active') el.classList.add('active');
    if (type === 'error') el.classList.add('error');
}

function generateMockPlaces(foodName, searchTerm) {
    const places = [];
    const prefixes = ['Qu√°n', 'Ti·ªám', 'Nh√† h√†ng', 'Qu·∫ßy', 'Xe'];
    const suffixes = ['Ngon', 'S·∫°ch', 'Gia truy·ªÅn', 'C√¥ Ba', 'Ch√∫ T∆∞', 'Anh Hai', 'Ch·ªã NƒÉm', '68', '99', 'H∆∞∆°ng V·ªã'];
    const streets = ['Nguy·ªÖn Hu·ªá', 'L√™ L·ª£i', 'Tr·∫ßn H∆∞ng ƒê·∫°o', 'Hai B√† Tr∆∞ng', 'Pasteur', 'V√µ VƒÉn T·∫ßn', 'ƒêi·ªán Bi√™n Ph·ªß', 'C√°ch M·∫°ng Th√°ng 8'];
    
    for (let i = 0; i < 5; i++) {
        const prefix = prefixes[Math.floor(Math.random() * prefixes.length)];
        const suffix = suffixes[Math.floor(Math.random() * suffixes.length)];
        const street = streets[Math.floor(Math.random() * streets.length)];
        const number = Math.floor(Math.random() * 200) + 1;
        const rating = (3.5 + Math.random() * 1.5).toFixed(1);
        const distance = (0.1 + Math.random() * 2).toFixed(1);
        const isOpen = Math.random() > 0.2;
        
        places.push({
            name: `${prefix} ${foodName} ${suffix}`,
            address: `${number} ${street}`,
            rating: parseFloat(rating),
            distance: parseFloat(distance),
            isOpen: isOpen,
            searchTerm: searchTerm
        });
    }
    
    return places.sort((a, b) => a.distance - b.distance);
}

function renderPlaces(places) {
    const container = document.getElementById('nearbyPlaces');
    
    if (places.length === 0) {
        container.innerHTML = `
            <div class="no-results">
                <div class="emoji">üò¢</div>
                <p>Kh√¥ng t√¨m th·∫•y qu√°n n√†o g·∫ßn ƒë√¢y</p>
            </div>
        `;
        return;
    }
    
    container.innerHTML = places.map(place => `
        <div class="place-card" onclick="openPlaceInMaps('${place.searchTerm}', '${place.address}')">
            <div class="place-icon">${currentFood ? currentFood.emoji : 'üçΩÔ∏è'}</div>
            <div class="place-info">
                <div class="place-name">${place.name}</div>
                <div class="place-address">üìç ${place.address}</div>
                <div class="place-meta">
                    <span class="place-rating">‚≠ê ${place.rating}</span>
                    <span class="place-distance">üìè ${place.distance} km</span>
                    <span class="place-status ${place.isOpen ? 'open' : 'closed'}">${place.isOpen ? 'üü¢ ƒêang m·ªü' : 'üî¥ ƒê√£ ƒë√≥ng'}</span>
                </div>
            </div>
        </div>
    `).join('');
}

async function findNearbyPlaces() {
    if (!currentFood) {
        alert('Vui l√≤ng quay s·ªë ƒë·ªÉ ch·ªçn m√≥n ƒÉn tr∆∞·ªõc!');
        return;
    }
    
    const btn = document.getElementById('findNearbyBtn');
    btn.innerHTML = '<span class="loading-spinner"></span> ƒêang t√¨m...';
    btn.disabled = true;
    
    try {
        await getUserLocation();
        updateLocationStatus(`üìç ${userLocation.lat.toFixed(4)}, ${userLocation.lng.toFixed(4)}`, 'active');
        
        // Simulate API delay
        await new Promise(resolve => setTimeout(resolve, 1000));
        
        const places = generateMockPlaces(currentFood.name, currentFood.searchTerm);
        renderPlaces(places);
        
    } catch (error) {
        updateLocationStatus('‚ùå Kh√¥ng th·ªÉ l·∫•y v·ªã tr√≠', 'error');
        // Still show mock results
        const places = generateMockPlaces(currentFood.name, currentFood.searchTerm);
        renderPlaces(places);
    }
    
    btn.innerHTML = 'üìç T√¨m qu√°n g·∫ßn ƒë√¢y';
    btn.disabled = false;
}

function openPlaceInMaps(searchTerm, address) {
    let url;
    if (userLocation) {
        url = `https://www.google.com/maps/search/${encodeURIComponent(searchTerm)}/@${userLocation.lat},${userLocation.lng},15z`;
    } else {
        url = `https://www.google.com/maps/search/${encodeURIComponent(searchTerm + ' ' + address)}`;
    }
    window.open(url, '_blank');
}

function openGoogleMaps() {
    if (!currentFood) {
        alert('Vui l√≤ng quay s·ªë ƒë·ªÉ ch·ªçn m√≥n ƒÉn tr∆∞·ªõc!');
        return;
    }
    
    let url;
    if (userLocation) {
        url = `https://www.google.com/maps/search/${encodeURIComponent(currentFood.searchTerm)}/@${userLocation.lat},${userLocation.lng},15z`;
    } else {
        url = `https://www.google.com/maps/search/${encodeURIComponent(currentFood.searchTerm + ' g·∫ßn ƒë√¢y')}`;
    }
    window.open(url, '_blank');
}

async function spin() {
    if (isSpinning) return;
    isSpinning = true;
    
    const btn = document.getElementById('spinBtn');
    btn.disabled = true;
    btn.textContent = 'üé∞ ƒêANG QUAY...';
    
    document.getElementById('foodName').classList.remove('show');
    document.getElementById('foodDesc').classList.remove('show');
    document.getElementById('foodTags').classList.remove('show');
    document.getElementById('luckyBadge').classList.remove('show');
    document.getElementById('mapsSection').classList.remove('show');

    let foodList = [];
    const profileFoods = foods[currentProfile];
    
    if (currentCategory === 'all') {
        foodList = [...profileFoods.snack, ...profileFoods.dinner];
    } else {
        foodList = profileFoods[currentCategory];
    }
    
    foodList = foodList.filter(f => f.price <= currentBudget);
    if (foodList.length === 0) {
        foodList = currentCategory === 'all' 
            ? [...profileFoods.snack, ...profileFoods.dinner]
            : profileFoods[currentCategory];
    }
    
    const selectedFood = foodList[Math.floor(Math.random() * foodList.length)];
    currentFood = selectedFood;
    const reels = [1, 2, 3].map(i => document.getElementById('reel' + i));
    
    reels.forEach((reel, index) => {
        let spins = 0;
        const maxSpins = 20 + index * 10;
        const spinDuration = (2000 + index * 500) / maxSpins;
        
        const interval = setInterval(() => {
            reel.innerHTML = '';
            const item = document.createElement('div');
            item.className = 'slot-item';
            item.textContent = allEmojis[Math.floor(Math.random() * allEmojis.length)];
            reel.appendChild(item);
            playSound('spin');
            spins++;
            
            if (spins >= maxSpins) {
                clearInterval(interval);
                reel.innerHTML = '';
                const finalItem = document.createElement('div');
                finalItem.className = 'slot-item';
                finalItem.textContent = selectedFood.emoji;
                reel.appendChild(finalItem);
            }
        }, spinDuration);
    });

    await new Promise(resolve => setTimeout(resolve, 3200));

    const isJackpot = Math.random() < 0.1;
    if (isJackpot) {
        document.getElementById('luckyBadge').classList.add('show');
        playSound('jackpot');
        createConfetti();
    } else {
        playSound('win');
    }

    document.getElementById('foodName').textContent = selectedFood.name;
    document.getElementById('foodName').classList.add('show');
    
    document.getElementById('foodDesc').textContent = selectedFood.desc;
    document.getElementById('foodDesc').classList.add('show');

    const tagsContainer = document.getElementById('foodTags');
    tagsContainer.innerHTML = '';
    selectedFood.tags.forEach(tag => {
        const tagEl = document.createElement('span');
        tagEl.className = 'food-tag';
        if (tag.includes('r·∫ª') || tag.includes('Gi√°')) tagEl.classList.add('price');
        if (tag.includes('Healthy') || tag.includes('Protein') || tag.includes('Low')) tagEl.classList.add('healthy');
        if (tag.includes('Nhanh') || tag.includes('Quick')) tagEl.classList.add('quick');
        tagEl.textContent = tag;
        tagsContainer.appendChild(tagEl);
    });
    tagsContainer.classList.add('show');

    // Show maps section
    setTimeout(() => {
        document.getElementById('mapsSection').classList.add('show');
        document.getElementById('nearbyPlaces').innerHTML = `
            <div class="no-results">
                <div class="emoji">üìç</div>
                <p>B·∫•m "T√¨m qu√°n g·∫ßn ƒë√¢y" ƒë·ªÉ xem g·ª£i √Ω</p>
            </div>
        `;
    }, 500);

    addToHistory(selectedFood);

    btn.disabled = false;
    btn.textContent = 'üé∞ QUAY L·∫†I!';
    isSpinning = false;
}

function addToHistory(food) {
    history.unshift(food);
    if (history.length > 5) history.pop();
    
    const container = document.getElementById('historyItems');
    container.innerHTML = '';
    history.forEach(item => {
        const el = document.createElement('div');
        el.className = 'history-item';
        el.textContent = `${item.emoji} ${item.name}`;
        container.appendChild(el);
    });
}

// Event listeners
document.querySelectorAll('.profile-btn').forEach(btn => {
    btn.addEventListener('click', () => {
        document.querySelectorAll('.profile-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        currentProfile = btn.dataset.profile;
        updateTheme(btn.dataset.theme);
    });
});

document.querySelectorAll('.tab').forEach(tab => {
    tab.addEventListener('click', () => {
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
        currentCategory = tab.dataset.category;
    });
});

document.getElementById('budgetSlider').addEventListener('input', (e) => {
    currentBudget = parseInt(e.target.value);
    document.getElementById('budgetValue').textContent = budgetLabels[currentBudget - 1];
});

document.getElementById('spinBtn').addEventListener('click', spin);
document.getElementById('findNearbyBtn').addEventListener('click', findNearbyPlaces);
document.getElementById('openMapsBtn').addEventListener('click', openGoogleMaps);

document.getElementById('soundToggle').addEventListener('click', () => {
    soundEnabled = !soundEnabled;
    document.getElementById('soundToggle').textContent = soundEnabled ? 'üîä' : 'üîá';
});

document.addEventListener('keydown', (e) => {
    if (e.code === 'Space' && !isSpinning) {
        e.preventDefault();
        spin();
    }
});

// Initialize
createFloatingFoods();
initReels();
updateTheme('theme-student');
</script>
</body>
</html>
